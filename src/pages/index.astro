---
import { ChatGPTAPI } from 'chatgpt'
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro</title>
		<script>
			const form = document.querySelector('#form')
			form.addEventListener('submit', processInput)

			async function processInput(event) {
				event.preventDefault(); // Verhindert das Neuladen der Seite
				const input = document.getElementById('inputField').value;
				const outputDiv = document.getElementById('output');
				
				// Hier kannst du eine Logik einfügen, um auf den Input zu antworten
				// Für dieses Beispiel gibt es einfach eine Antwort zurück
				const response = await fetch('/chatgpt', {
					method: 'POST',
					body: input,
				}).then(res => res.text())

				outputDiv.innerText = response;
				
				saveToHistory(input, response.answer);

				// Leert das Eingabefeld
				document.getElementById('inputField').value = '';

				function saveToHistory(input, response) {
            const history = JSON.parse(localStorage.getItem('chatHistory')) || [];
            history.push({ input, response });
            localStorage.setItem('chatHistory', JSON.stringify(history));
            updateHistoryList();

			function updateHistoryList() {
            const history = JSON.parse(localStorage.getItem('chatHistory')) || [];
            const historyDiv = document.getElementById('historyList');
            historyDiv.innerHTML = ''; // Leert die Liste
            history.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `Eingabe: "${item.input}" - Antwort: "${item.response}"`;
                historyDiv.appendChild(li);
            });
        }

        }
			}
		</script>
		
	</head>
	<body>
		<img src="/logo.png" alt="" srcset="">
		<form id="form">
			<label for="inputField">Gib etwas ein:</label>
			<input type="text" id="inputField" name="inputField" required>
			<input type="submit" value="Antwort erhalten">
		</form>
		
		<div id="output"></div>

		
	</body>
</html>
